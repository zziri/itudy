# 03 함수

어떤 프로그램이든 가장 기본적인 단위가 함수이다

## 작게 만들어라

함수를 만드는 첫째 규칙은 '작게!'다. 함수를 만드는 둘째 규칙은 '더 작게!'다.

함수는 100줄을 넘어서는 안 된다. 아니 20줄도 길다.

if, else, while 등에 들어가는 블록은 한 줄이어야 한다. 대개 거기서 함수를 호출한다. 바깥을 감싸는 함수가 작아질 뿐만 아니라, 블록 안에서 호출하는 함수 이름을 적절히 짓는다면, 코드를 이해하기도 쉬워진다.

## 한 가지만 해라

함수는 한 가지를 해야한다. 그 한 가지를 잘 해야 한다. 그 한 가지만을 해야 한다.

지정된 함수 이름 아래에서 추상화 수준이 하나인 단계만 수행한다면 그 함수는 한 가지 작업만 한다.

## 함수 당 추상화 수준은 하나로

함수가 확실히 한 가지 작업만 하려면 함수 내 모든 문장의 추상화 수준이 동일 해야 한다.

getHtml()은 추상화 수준이 높음, PathParser.render(pagepath)는 추상화 수준이 중간, .append("\n")와 같은 코드는 추상화 수준이 아주 낮음. 이런 코드들이 섞여있지 않도록 해야 한다.

## 내려가기 규칙

코드는 위에서 아래로 이야기처럼 읽혀야 좋다. 한 함수 다음에는 추상화 수준이 한 단계 낮은 함수가 온다. 즉 프로그램을 위에서 아래로 읽으면 함수 추상화 수준이 한 단계씩 낮아진다.

## switch

함수는 한 가지만 해야 좋다. 하지만 본질적으로 switch 문은 N가지 일을 한다. 다형성을 이용해서 각 switch 문을 저차원 클래스에 숨기고 반복하지 않는 방법은 있다. switch 문을 추상 팩토리에 숨기고 각 케이스에 따라 적절한 파생 클래스의 인스턴스를 생성한다. 이렇게 상속 관계를 이용해서 switch 문을 숨긴다.

## 서술적인 이름을 사용해라

서술적인 이름은 함수가 하는 일을 좀 더 잘 표현하도록 한다. 길고 서술적인 이름이 짧고 어려운 이름보다 좋다. 길고 서술적인 이름이 길고 서술적인 주석보다 좋다. 함수 이름을 정할 때는 여러 단어가 쉽게 읽히는 명명법을 사용한다.

## 함수 인수

함수에서 이상적인 인수 개수는 0개(무항)이다

출력 인수는 입력 인수보다 이해하기 어렵다. ex) sprintf(buf, "something to print")

// 물론 C는 객체지향 언어가 아니므로 출력 인수를 사용해야할 때도 있다

## 단항 형식

함수에 인수를 1개를 넘기는 경우는 두 가지이다

함수에 질문을 던지는 경우이다. ex) boolean fileExists("file name")

이벤트 함수의 경우이다. ex) passwordAttemptFailedNtimes(int attempts)

## 플래그 인수

플래그 인수는 추하다. 함수가 여러가지 일을 한다고 공표하는 셈이다. 플래그 인수가 넘어와서 처리해야 하는 상황이라면 wrapping을 하는 것이 좋다고 본다.

## 인수 객체

인수가 많이 필요하다면 일부를 객체로 묶어도 좋다. 변수를 묶으려면 이름을 붙이게 된다. 그러면 자연스럽게 개념을 표현하게 된다.

## 동사와 키워드

단항 함수는 인수가 동사/명사 쌍을 이루는 것이 좋다. write(name) 보다는 writeField(name)이 더 좋다.

## 부수 효과를 일으키지 마라

함수는 마치 한 가지를 하겠다고 약속한 것과 같다. 그러므로 부수 효과는 거짓말이다. 한 가지를 하겠다고 약속하고 남 몰래 함수에서 여러가지 일을 하는 것이기 때문이다. 부수 효과를 일으키는 함수는 혼란을 야기한다.

## 출력 인수

일반적으로 우리는 인수는 입력이라고 인식한다.

public void appendFooter(StringBuffer report)와 같이 함수를 정의하고 appendFooter(s) 와 같이 호출하는 것 보다 report.appendFooter() 와 같이 구현하는 것이 더 좋다. 객체 지향에서 출력 인수로 사용하라고 설계한 것이 this이다. 적극 활용하자, 물론 C와 같은 절차 지향 언어에서는 출력 인수가 불가피한 상황도 있을 수 있다. 객체 지향도 불가피한 상황은 있으나 되도록 피하자.

## 명령과 조회를 분리하라

함수에서 뭔가 수행하거나 답하거나 둘 중 하나만 해야한다. 객체 상태를 변경하거나, 객체 정보를 반환하거나 둘 중 하나이다.

```java
if (set("username", "unclebob")) ...
```

명령과 조회를 동시에 하면 위와 같은 코드가 나오게 된다. set 함수이지만 if문 안에 있다. 이는 읽는 사람이 이해하기 어렵게 한다.

```java
if (attributeExists("username")) {
	setAttribute("username", "unclebob");
	...
}
```

위와 같이 명령과 조회를 분리하면 이런 혼란을 막을 수 있다

## 오류 코드보다 예외를 사용해라

커널이나 펌웨어에서는 사용하기 어렵겠지만 애플리케이션 영역에서는 예외를 사용하는 것이 좋다. if 문으로 떡칠된 오류 처리 코드보다 예외를 사용하면 약간의 try/catch 구문으로 오류 처리가 가능하다.

```java
try {
	deletePage(page);
	regitstry.deleteReference(page.name);
	configKeys.deleteKey(page.name.makeKey());
} catch (Exception e) {
	logger.log(e.getMessage());
}
```

try/catch 블록은 원래 추하다. 코드 구조에 혼란을 일으키며, 정상 동작과 오류 처리 동작을 뒤섞는다. 그래서 try/catch 블록을 별도 함수로 뽑아내는 편이 더 좋다.

```java
public void delete(Page page) {
	try {
		deletePageAndAllReferences(page);
	} catch (Exception e) {
		logError(e);
	}
}
```

## 반복하지 마라

SW를 짜는 행위는 글짓기와 비슷하다. 처음에는 장황하고 복잡하게 짜여지겠지만 이후 여러 번의 수정을 거쳐 반복하는 코드를 지우고 점점 단순하게, 깔끔한 함수를 작성할 수 있을 것이다.